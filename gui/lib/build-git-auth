#!/bin/bash
# build-git-auth.sh - Clean git-auth binary builder (Plain text)

set -e

echo "ğŸš€ Building git-auth binary..."
echo "ğŸ“¦ Using -ldflags "-s -w" for smaller size"

# Build optimized binary
go build -ldflags="-s -w" -o git-auth git-auth.go

# Fix size calculation & comparison
before=$(stat -c%s main.go 2>/dev/null || ls -l main.go | awk '{print $5}')
after=$(ls -l git-auth | awk '{print $5}')

echo "âœ… Build successful!"
echo "ğŸ“Š main.go: ${before}B â†’ git-auth: ${after}B"
echo "ğŸ’¾ Size: $(printf "%.1f%%" $(( (before*2-after)*100 / (before*2) )))% smaller"

echo "ğŸ‰ git-auth binary ready!"
echo "ğŸ’¡ Test: ./git-auth"
echo "ğŸ’¡ Move: mv git-auth ~/bin/"

# Quick test
echo
echo "ğŸ” Testing SSH..."
./git-auth 2>&1 | head -3
